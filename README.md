# Readme
##Starbax

##### Functionality of package
This package is a collection of scripts and message definitions created to have a Baxter robot prepare a cup of coffee using a single serve coffee maker, one cup, and one single serve packet of coffee. The objects must be set at a specific height and the coffee maker must face Baxter, but objects can otherwise be placed arbitrarily so long as Baxter can easily reach them.

This package also makes use of the CVBridge to convert between ROS images and CV images when performing color segmentation.

Additonally, the package uses Baxter's in-built inverse kinematics service to move to desired locations. The objective is to approach the objects horizontally and while keeping level, place them at the desired position.
 
In total, there are three main sections of this project: Color Segmentation, AR tag Recognition, and Inverse kinematics to move Baxter's end effector. 


![baxpicture](./picturepathfrompackage)

One [launch file][launch] is being worked on so that everything can be started with a single command.


##### [Scripts][src]

* General script facts, warnings and instructions

* [node name][linkid]: What the node does

* Ex: The [wander.py][src-node4] script launches a node that causes the turtlebot to monitor data from its [environmental scanners][src-node4-monitor] for nearby obstacles while moving. If the turtlebot [detects an obstacle][src-node4-stop] within 1.2m or has been moving for 10 seconds it will stop for 5 seconds, spin for 5 seconds, and begin moving in the new direction.


The [pic_cal_sw.py](src/pic_cal_sw.py) script launches the node `pic_cal` that subscribes to Baxter's left hand camera topic -`/cameras/left_hand_camera/image`. While not actually run in the launch file, this node was used to obtain clear images of the blue, yellow, and pink post-it-notes that Baxter used to differentiate between the three different objects: the Keurig, cup, and K-cup. These pictures can be found [here](media/). 

The [table_cam_sw.py](src/table_cam_sw.py) script launches the node `table_cam` that subscribes to Baxter's left hand camera topic - `/cameras/left_hand_camera/image`. It then loads the three post-it-note images from the media folder and uses histogram-based color segmentation to create three masks - one for each color. Assuming the camera has a clear view of all three post-it-notes, it finds the centroids and compares them to find their relative positions. It then publishes a String message on the `pos_items` topic listing the objects from left to right as one faces Baxter. 

The [starbax_sw.py](/src/starbax_sw.py) script launches the node `initial` that positions Baxter's left arm so that it's camera has a top-down view of the table where the Keurig, cup, and K-cup are located.


The [artransforms.py][src-node4] script will sunscribe to the ar_pose_marker topic that was generated by the Avlar Marker package. This scrip will then extract the id, the x,y,z , and orientation data of each of the tags and republishes them on the topic ar_pose_id as a custom message type called ar_tag. 

The [pose_and_item.py](/src/pose_and_item) script launches the node `pose_item` that subscribes to the `pos_items` and `ar_pose_id` topics to get the relative positions of the objects and their pose in the world. The incoming pose is of the `ar_tag` message defintin. It then sorts the three poses from least to greatest using their 'y' coordinates. The pose with the smallest 'y' coordinate is then paired with the left most object as one faces Baxter, and so forth. Finally, the node publishes a new message (`ar_tagstr`) contatining the object name and the pose.

The [movement.py][src-node4] script launches 
Breaking the process of picking and place an obect into several small independent tasks, this node defines each of these tasks as a seperate function. The main function calls all of these in the correct order while taking the poses of the objects from the pose_and_item.py node. This information is recieved by the subscribing to the topic "pose_and_item".
The node also calls services to open and close the Keurig lid.


The [open_service.py][src-node4] script launches 

The [close_service.py][src-node4] script launches

##### Topics & Services
* /cmd_vel is the default publish topic for all geometry_msgs/Twist messages in the package. This is appropriate for using with turtlesim, but will not work if launching with Gazebo. See remapping note in the Scripts section.



##### Parameters
* Parameter general notes
* /parameter_name description


##### [Launch Files][launch]

* [launch file name][linkid2]




[src]:https://github.com/repo_name/src_folder
[linkid]:https://github.com/repo_name/src_folder/specific_file.
[launch]:https://github.com/repo_name/launch_folder
[linkid2]:https://github.com/repo_name/launch_folder/specific_file


[launch-launch1]:https://github.com/ME495-EmbeddedSystems/walkthrough-2-f2017-idtx314/blob/44911fff172c58759b056094a9611f1dcc81035c/launch/keys_to_twist_with_ramps.launch

